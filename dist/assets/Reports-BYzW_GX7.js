import{c as A,j as e,h as j,g as f,r as g,a as B,i as V,k as h}from"./index-HP-iplJH.js";import{C as m,a as u,c as x,b as N,Q as b}from"./queryKeys-BQvMjTHe.js";import{u as L,B as M}from"./ApiMutation-BaAjGkoK.js";import{U,u as F,D as G,T as H,S as T,a as w,b as R,c as S,d as P}from"./useBranches-C0c4YbNX.js";import{S as i,T as q}from"./tableSkeleton-rJUGKhHK.js";import{P as $}from"./package-BPev8DMd.js";import{C as I}from"./chart-column-o8iyFS3j.js";import{A as Y}from"./apiEndpoints-DpVCCeQ4.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=A("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=A("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),_=()=>e.jsxs(m,{className:"bg-gradient-card shadow-md",children:[e.jsxs(u,{className:"pb-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(i,{className:"h-5 w-1/2"}),e.jsx(i,{className:"h-4 w-1/6"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-muted-foreground mt-2",children:[e.jsx(i,{className:"h-4 w-16"}),e.jsx(i,{className:"h-4 w-8"})]})]}),e.jsxs(x,{className:"space-y-3",children:[[...Array(5)].map((s,l)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx(i,{className:"h-4 w-1/3"}),e.jsx(i,{className:"h-4 w-1/4"})]},l)),e.jsx(i,{className:"h-4 w-full"}),e.jsx("div",{className:"grid grid-cols-4 gap-3 pt-2",children:[...Array(4)].map((s,l)=>e.jsx(i,{className:"h-8 col-span-1"},l))})]})]}),Q=()=>{const{globalBranchId:s,globalTimeInterval:l,setTopSellingProductData:a}=j(),{data:r,isPending:c}=f(b.GET_REPORTS_TOP_SELLING_PRODUCTS(l,s),{retry:0,enabled:!!s});return g.useEffect(()=>{r?.data&&a(r?.data)},[r,l,s]),e.jsx(e.Fragment,{children:e.jsxs(m,{className:"shadow-md",children:[e.jsx(u,{children:e.jsxs(N,{className:"flex items-center space-x-2",children:[e.jsx($,{className:"h-5 w-5"}),e.jsx("span",{children:"Top Selling Products"})]})}),e.jsx(x,{children:c?[...Array(1)].map((t,n)=>e.jsx(_,{},n)):r?.data?.length?e.jsx("div",{className:"space-y-3",children:r?.data.map((t,n)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-primary text-primary-foreground rounded-full flex items-center justify-center text-sm font-bold",children:n+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.name}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t?.quantitySold," units sold"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium",children:["NPR ",t?.totalRevenue.toFixed(2)]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Revenue"})]})]},t.name))}):e.jsx("p",{className:"text-muted-foreground text-center",children:"No data found"})})]})})},W=()=>{const{globalBranchId:s,globalTimeInterval:l,setTopCustomersData:a}=j(),{data:r,isPending:c}=f(b.GET_REPORTS_TOP_CUSTOMERS(l,s),{retry:0,enabled:!!s});return g.useEffect(()=>{r?.data&&a(r?.data)},[r,l,s]),e.jsxs(e.Fragment,{children:[e.jsxs(m,{className:"shadow-md",children:[e.jsx(u,{children:e.jsxs(N,{className:"flex items-center space-x-2",children:[e.jsx(U,{className:"h-5 w-5"}),e.jsx("span",{children:"Top Customers"})]})}),e.jsx(x,{children:c?[...Array(1)].map((t,n)=>e.jsx(_,{},n)):r?.data?.length?e.jsx("div",{className:"space-y-3",children:r?.data?.map((t,n)=>e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-muted/50",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-secondary text-secondary-foreground rounded-full flex items-center justify-center text-sm font-bold",children:n+1}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:t.fullName}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:[t?.totalVisit," purchases"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium",children:["NPR ",t?.totalAmount?.toLocaleString()]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total spent"})]})]},t?.id))}):e.jsx("p",{className:"text-muted-foreground text-center",children:"No data found"})})]})," "]})},J=V("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function E({className:s,variant:l,...a}){return e.jsx("div",{className:B(J({variant:l}),s),...a})}const K=()=>{const{globalBranchId:s,setRecentTransaction:l}=j(),{data:a,isPending:r,isRefetching:c}=f(b.GET_REPORTS_RECENT_TRANSACTIONS(s),{enabled:!!s,retry:0,queryParams:{}});return g.useEffect(()=>{a?.data&&l(a?.data)},[a,s]),e.jsx(e.Fragment,{children:e.jsxs(m,{className:"shadow-md",children:[e.jsx(u,{children:e.jsx(N,{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(I,{className:"h-5 w-5"}),e.jsx("span",{children:"Recent Transactions"})]})})}),e.jsx(x,{children:r||c?e.jsx(q,{rows:2,columns:7}):a?.data?.length?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"text-left py-3 px-2 font-medium text-muted-foreground",children:"S.No"})," ",e.jsx("th",{className:"text-left py-3 px-2 font-medium text-muted-foreground",children:"Patient"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-muted-foreground",children:"Product"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-muted-foreground",children:"Items"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-muted-foreground",children:"Amount"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-muted-foreground",children:"VAT (13%)"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-muted-foreground",children:"Date"}),e.jsx("th",{className:"text-left py-3 px-2 font-medium text-muted-foreground",children:"Transaction ID"})]})}),e.jsx("tbody",{children:a?.data?.map((t,n)=>e.jsxs("tr",{className:"border-b border-border hover:bg-muted/50",children:[e.jsx("td",{className:"py-3 px-2 font-medium",children:n+1}),e.jsx("td",{className:"py-3 px-2 font-medium",children:t?.patientName}),e.jsx("td",{className:"py-3 px-2",children:e.jsx(E,{className:"bg-accent-foreground text-success-foreground text-sm",children:t.productNames})}),e.jsx("td",{className:"py-3 px-2",children:e.jsxs(E,{variant:"outline",children:[t?.itemsCount," items"]})}),e.jsxs("td",{className:"py-3 px-2 font-medium",children:["NPR ",t?.amount?.toFixed(2)]}),e.jsxs("td",{className:"py-3 px-2 text-warning font-medium",children:["NPR ",t?.vat?.toFixed(2)]}),e.jsx("td",{className:"py-3 px-2 text-muted-foreground",children:new Date(t?.date)?.toLocaleDateString("en-GB")}),e.jsx("td",{className:"py-3 px-2",children:e.jsx("span",{className:"font-mono text-sm",children:t?.transactionId})})]},n))})]})}):e.jsx("p",{className:"text-muted-foreground text-center",children:"No data found"})})]})})};function X(s,l="file.bin",a){let r;s.data instanceof Blob?r=s.data:s.data instanceof ArrayBuffer?r=new Blob([s.data],{type:a}):r=new Blob([JSON.stringify(s.data)],{type:a});const c=r.slice(0,r.size,a),t=window.URL.createObjectURL(c),n=document.createElement("a");n.href=t,n.download=l,document.body.appendChild(n),n.click(),n.remove(),window.URL.revokeObjectURL(t)}function de(){const{branches:s,branchLoading:l}=F(),{globalBranchId:a,setGlobalBranchId:r,globalTimeInterval:c,setGlobalTimeInterval:t}=j();g.useEffect(()=>{s.length>0&&a===null&&r(s[0].value)},[s]);const n=a!==null,{data:o}=f(b.GET_REPORTS_HEADER_DATA(c,a),{enabled:n,retry:0}),{mutate:k,isPending:y}=L("post",Y.REPORTS.EXPORT_PDF_REPORT(c,a),{responseType:"blob"}),v=()=>{switch(c){case h.Daily:return"Today";case h.Weekly:return"This Week";case h.Monthly:return"This Month";case h.Yearly:return"This Year";default:return"Today"}},D=()=>{k(void 0,{onSuccess:d=>{X(d,"report.pdf","application/pdf")}})},O=[{title:`${v()} Sales`,value:`NPR ${Math.round(o?.data?.todaySales??0)}`,icon:G},{title:"VAT Collected (13%)",value:`NPR ${Math.round(o?.data?.vatCollected??0)}`,icon:C},{title:"Transactions",value:`${o?.data?.transactionCount}`,icon:I},{title:"Avg. Transaction",value:`NPR ${Math.round(o?.data?.averageTransaction??0)}`,icon:H}];return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Reports & Analytics"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Nepal VAT compliant reporting and business insights"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs(T,{value:a!==null?String(a):void 0,onValueChange:d=>r(Number(d)),disabled:l,children:[e.jsx(w,{children:e.jsx(R,{placeholder:"Select branch"})}),e.jsx(S,{children:s.map(d=>e.jsx(P,{value:String(d.value),children:d.label},d.value))})]}),e.jsxs(T,{value:c,onValueChange:d=>t(d),children:[e.jsx(w,{className:"w-40",children:e.jsx(R,{placeholder:"Select period"})}),e.jsx(S,{children:Object.entries(h).map(([d,p])=>e.jsx(P,{value:p,children:d},p))})]}),e.jsxs(M,{className:"bg-gradient-primary shadow-md hover:shadow-lg transition-all",onClick:D,disabled:y,children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),y?"Exporting...":"Export"]})]})]}),e.jsx("div",{id:"report-content",className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:O?.map(d=>{const p=d.icon;return e.jsx(m,{className:"bg-gradient-card shadow-md",children:e.jsx(x,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:d.title}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:d.value})]}),e.jsx("div",{className:"p-2 bg-primary-light rounded-lg",children:e.jsx(p,{className:"h-6 w-6 text-primary"})})]})})},d.title)})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(Q,{}),e.jsx(W,{})]}),e.jsx("div",{children:e.jsx(K,{})}),e.jsxs(m,{className:"shadow-md",children:[e.jsx(u,{children:e.jsxs(N,{className:"flex items-center space-x-2",children:[e.jsx(C,{className:"h-5 w-5"}),e.jsx("span",{children:"VAT Summary - Nepal Tax Compliance"})]})}),e.jsxs(x,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"text-center p-4 rounded-lg bg-warning-light",children:[e.jsx("div",{className:"text-2xl font-bold text-warning",children:"13%"}),e.jsx("div",{className:"text-sm text-warning/80",children:"Standard VAT Rate"})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg bg-success-light",children:[e.jsxs("div",{className:"text-2xl font-bold text-success",children:["NPR ",o?.data?.vatCollected.toLocaleString()]}),e.jsxs("div",{className:"text-sm text-success/80",children:["VAT Collected ",v()]})]}),e.jsxs("div",{className:"text-center p-4 rounded-lg bg-primary-light",children:[e.jsxs("div",{className:"text-2xl font-bold text-primary",children:["NPR"," ",((o?.data?.todaySales??0)-(o?.data?.vatCollected??0)).toLocaleString()]}),e.jsxs("div",{className:"text-sm text-primary/80",children:["Net Sales ",v()]})]})]}),e.jsxs("div",{className:"mt-6 p-4 bg-muted rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"VAT Compliance Notes:"}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[e.jsx("li",{children:"• All transactions include 13% VAT as per Nepal Tax regulations"}),e.jsx("li",{children:"• VAT collection reports are ready for submission to Inland Revenue Department"}),e.jsx("li",{children:"• System maintains detailed transaction records for audit purposes"})]})]})]})]})]})}export{de as default};
